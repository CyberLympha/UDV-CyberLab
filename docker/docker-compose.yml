version: "3.8"

services:
  auth:
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker-Development
      - DB_AUTH_URL=${DB_AUTH_URL}
    image:
        ssoncho/udv-cyberlab:v2.1
    ports:
      - "8081:8080"
    extra_hosts:
      - "host.docker.internal:host-gateway"

    
  virtual_lab:
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker-Development
      - IP_PROXMOX=10.40.229.10
      - PROXMOX_TOKEN=root@pam!devil=e094061e-e909-4415-9a57-f353a81a9eed
      - AUTH_URL=${AUTH_URL}
      - DB_LABS_URL=${DB_LABS_URL}
    image:
        ssoncho/udv-cyberlab-temp:v1.1
    ports:
      - "8080:8080"
    extra_hosts:
      - "host.docker.internal:host-gateway"

  frontend:
    environment:
     - AUTH_URL=${AUTH_URL}
     - LABS_URL=${LABS_URL}
    image:
        ssoncho/udv-cyberlab-frontend:v1.1
    ports:
      - "8082:8082"
    extra_hosts:
      - "host.docker.internal:host-gateway"

  postgres_auth:
    image: postgres:15
    container_name: postgres-auth
    environment:
      POSTGRES_DB: Auth
      POSTGRES_USER: user
      POSTGRES_PASSWORD: 123123
    volumes:
      - ./auth/:/docker-entrypoint-initdb.d
      - data-auth:/var/lib/postgresql/data
    ports:
      - "5433:5432"

  postgres_labs:
    image: postgres:15
    container_name: postgres-labs
    environment:
      POSTGRES_DB: Labs
      POSTGRES_USER: dev
      POSTGRES_PASSWORD: 123123
    volumes:
      - ./labs/:/docker-entrypoint-initdb.d
      - data-labs:/var/lib/postgresql/data
    ports:
      - "5432:5432"
volumes:
 data-auth:
 data-labs: