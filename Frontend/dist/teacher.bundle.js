/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/scripts/api/teacher/teacherLabs.js":
/*!************************************************!*\
  !*** ./src/scripts/api/teacher/teacherLabs.js ***!
  \************************************************/
/***/ (() => {

eval("const accessToken = localStorage.getItem(\"accessToken\");\r\nconst apiUrl = \"http://localhost:8080\";\r\n\r\nfunction getAllTeacherLabs() {\r\n    const teacherId = localStorage.getItem(\"currentUserId\"); // ID учителя\r\n    const url = `${apiUrl}/Labs/teacher/${teacherId}`;\r\n\r\n    fetch(url, {\r\n        method: 'GET',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': 'Bearer' + ' ' + accessToken\r\n        }\r\n    })\r\n        .then(response => {\r\n            if (!response.ok) {\r\n                if (response.status == 401)\r\n                    window.location.href = \"../auth/LoginPageStudent.html\"\r\n                throw new Error('Network response was not ok');\r\n            }\r\n            return response.json();\r\n        })\r\n        .then(data => {\r\n            addLabCardsToDOM(data);\r\n        })\r\n        .catch(error => {\r\n            console.error('There has been a problem with your fetch operation:', error);\r\n        });\r\n}\r\n\r\nfunction addLabCardsToDOM(labs) {\r\n    const labsList = document.querySelector('.labs-list');\r\n    labs.forEach(lab => {\r\n        const labCard = document.createElement('a');\r\n        labCard.classList.add('lab-card-mini');\r\n        labCard.href = 'TeacherLabs.html';\r\n        labCard.id = `${lab.id}`;\r\n        labCard.onclick = function(e){\r\n            localStorage.setItem(\"currentLabId\", lab.id);\r\n            localStorage.setItem(\"currentLabName\", lab.name);\r\n        }\r\n\r\n        const labName = document.createElement('span');\r\n        labName.classList.add('heading', 'lab-name');\r\n        labName.textContent = lab.name;\r\n\r\n        labCard.appendChild(labName);\r\n        labsList.appendChild(labCard);\r\n    });\r\n}\r\n\r\nfunction getUserLabsPerLab(labId){\r\n    const url = `${apiUrl}/Labs/${labId}/userLabs`;\r\n    fetch(url, {\r\n        method: 'GET',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': 'Bearer' + ' ' + accessToken\r\n        }\r\n    })\r\n        .then(response => {\r\n            if (!response.ok) {\r\n                if (response.status == 401)\r\n                    window.location.href = \"../auth/LoginPageStudent.html\"\r\n                throw new Error('Network response was not ok');\r\n            }\r\n            return response.json();\r\n        })\r\n        .then(data => {\r\n            addUserLabCardsToDOM(data);\r\n        })\r\n        .catch(error => {\r\n            console.error('There has been a problem with your fetch operation:', error);\r\n        });\r\n}\r\n\r\nfunction addUserLabCardsToDOM(labs) {\r\n    const labsList = document.querySelector('.labs-list');\r\n    labs.forEach(lab => {\r\n        const labCard = document.createElement('a');\r\n        labCard.classList.add('lab-card-mini');\r\n        labCard.href = 'TeacherLab.html';\r\n        labCard.onclick = function(e){\r\n            localStorage.setItem(\"currentUserLabId\", lab.id);\r\n        }\r\n\r\n        const heading = document.createElement('span');\r\n        heading.classList.add('heading');\r\n\r\n        const firstName = document.createElement('span');\r\n        firstName.id = \"firstName\";\r\n        firstName.textContent = lab.firstName;\r\n\r\n        const secondName = document.createElement('span');\r\n        secondName.id = \"secondName\";\r\n        secondName.textContent = lab.secondName;\r\n\r\n        heading.appendChild(firstName);\r\n        heading.appendChild(document.createTextNode(' '));\r\n        heading.appendChild(secondName);\r\n\r\n        const lastSentAt = document.createElement('span');\r\n        lastSentAt.id = \"lastSentAt\";\r\n        lastSentAt.textContent = formatDate(lab.lastSentAt);\r\n\r\n        const lastRate = document.createElement('span');\r\n        lastRate.id = \"lastRate\";\r\n        lastRate.textContent = `${lab.lastRate}/100 баллов`;\r\n\r\n        labCard.appendChild(heading);\r\n        labCard.appendChild(lastSentAt);\r\n        labCard.appendChild(lastRate);\r\n\r\n        labsList.appendChild(labCard);\r\n    });\r\n}\r\n\r\nfunction formatDate(dateString) {\r\n    const options = {\r\n        year: 'numeric',\r\n        month: '2-digit',\r\n        day: '2-digit',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n    };\r\n    return new Date(dateString).toLocaleString('ru-RU', options).replace(',', ' ');\r\n}\r\n\r\nfunction getAttemptInfo(){\r\n    const url = `${apiUrl}/Labs/attempts/${localStorage.getItem(\"currentUserLabId\")}`;\r\n    fetch(url, {\r\n        method: 'GET',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': 'Bearer' + ' ' + accessToken\r\n        }\r\n    })\r\n        .then(response => {\r\n            if (!response.ok) {\r\n                if (response.status == 401)\r\n                    window.location.href = \"../auth/LoginPageStudent.html\"\r\n                throw new Error(`HTTP error! status: ${response.status}`);\r\n            }\r\n            return response.json();\r\n        })\r\n        .then(data => {\r\n            setAttemptContent(data);\r\n        })\r\n        .catch(error => {\r\n            console.error('Error fetching data:', error);\r\n        });\r\n} \r\n\r\nfunction updateUserLabRate() {\r\n    const newRate = Number(document.getElementById('new-rate').value);\r\n    const url = `${apiUrl}/Labs/attempts/${localStorage.getItem(\"currentUserLabId\")}`;\r\n    const payload = { newRate: newRate };\r\n\r\n    fetch(url, {\r\n        method: 'PATCH',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': 'Bearer' + ' ' + accessToken\r\n        },\r\n        body: JSON.stringify(payload)\r\n    })\r\n        .then(response => {\r\n            if (!response.ok) {\r\n                if (response.status == 401)\r\n                    window.location.href = \"../auth/LoginPageStudent.html\"\r\n                throw new Error(`HTTP error! status: ${response.status}`);\r\n            }\r\n            return response.json();\r\n        })\r\n        .then(data => {\r\n            setAttemptContent(data);\r\n        })\r\n        .catch(error => {\r\n            console.error('Error saving rate:', error);\r\n        });\r\n}\r\n\r\nfunction setAttemptContent(data) {\r\n    document.getElementById('second-name-student').textContent = data.secondName;\r\n    document.getElementById('first-name-student').textContent = data.firstName;\r\n    document.getElementById('last-sent-at').textContent = formatDate(data.lastSentAt);\r\n    document.getElementById('last-rate').textContent = `${data.lastRate}/100 баллов`;\r\n    document.getElementById('report').textContent = data.report;\r\n}\r\n\r\nwindow.getAllTeacherLabs = getAllTeacherLabs;\r\nwindow.getUserLabsPerLab = getUserLabsPerLab;\r\nwindow.getAttemptInfo = getAttemptInfo;\r\nwindow.updateUserLabRate = updateUserLabRate;\n\n//# sourceURL=webpack://udvneolab/./src/scripts/api/teacher/teacherLabs.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/scripts/api/teacher/teacherLabs.js"]();
/******/ 	
/******/ })()
;